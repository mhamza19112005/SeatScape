{% extends 'base.html' %}
{% block title %}SeatScape - Events{% endblock %}
{% block content %}
     <!-- ==========Banner-Section========== -->
     <section class="banner-section">
        <div class="banner-bg bg_img" data-background="https://pixner.net/boleto/demo/assets/images/banner/banner05.jpg"></div>
        <div class="container">
            <div class="banner-content event-content">
                <h1 class="title bold">get <span class="color-theme">events</span> tickets</h1>
                <p>Buy event tickets in advance, find event times and much more</p>
            </div>
        </div>
    </section>
    <!-- ==========Banner-Section========== -->

    <!-- ==========Ticket-Search========== -->
    <section class="search-ticket-section padding-top pt-lg-0">
    <div class="container">
            <div class="search-tab bg_img" data-background="https://pixner.net/boleto/demo/assets/images/ticket/ticket-bg01.jpg">
                <div class="row align-items-center mb--20">
                    <div class="col-lg-6 mb-20">
                        <div class="search-ticket-header">
                            <h6 class="category">welcome to Boleto </h6>
                            <h3 class="title">what are you looking for</h3>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-20">
                        <ul class="tab-menu ticket-tab-menu">
                            <li>
                                <div class="tab-thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/ticket-tab01.png" alt="ticket">
                                </div>
                                <span>movie</span>
                            </li>
                            <li class="active">
                                <div class="tab-thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/ticket-tab02.png" alt="ticket">
                                </div>
                                <span>events</span>
                            </li>
                            <li>
                                <div class="tab-thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/ticket-tab03.png" alt="ticket">
                                </div>
                                <span>sports</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="tab-area">
                    <div class="tab-item">
                        <form class="ticket-search-form">
                            <div class="form-group large">
                                <input type="text" placeholder="Search fo Movies">
                                <button type="submit"><i class="fas fa-search"></i></button>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/city.png" alt="ticket">
                                </div>
                                <span class="type">city</span>
                                <select class="select-bar">
                                    <option value="london">London</option>
                                    <option value="dhaka">dhaka</option>
                                    <option value="rosario">rosario</option>
                                    <option value="madrid">madrid</option>
                                    <option value="koltaka">kolkata</option>
                                    <option value="rome">rome</option>
                                    <option value="khoksa">khoksa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/date.png" alt="ticket">
                                </div>
                                <span class="type">date</span>
                                <select class="select-bar">
                                    <option value="26-12-19">23/10/2020</option>
                                    <option value="26-12-19">24/10/2020</option>
                                    <option value="26-12-19">25/10/2020</option>
                                    <option value="26-12-19">26/10/2020</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/cinema.png" alt="ticket">
                                </div>
                                <span class="type">cinema</span>
                                <select class="select-bar">
                                    <option value="Awaken">Awaken</option>
                                    <option value="dhaka">dhaka</option>
                                    <option value="rosario">rosario</option>
                                    <option value="madrid">madrid</option>
                                    <option value="koltaka">kolkata</option>
                                    <option value="rome">rome</option>
                                    <option value="khoksa">khoksa</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="tab-item active">
                        <form class="ticket-search-form" method="get">
                            <div class="form-group large">
                                <input type="text" name="q" value="{{ search_query }}" placeholder="Search for Events">
                                <button type="submit"><i class="fas fa-search"></i></button>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/city.png" alt="ticket">
                                </div>
                                <span class="type">city</span>
                                <select class="select-bar" name="city" onchange="this.form.submit()">
                                    <option value="">All</option>
                                    {% for c in cities %}
                                    <option value="{{ c }}" {% if selected_city == c %}selected{% endif %}>{{ c }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/date.png" alt="ticket">
                                </div>
                                <span class="type">date</span>
                                <input type="date" name="date" value="{{ selected_date }}" onchange="this.form.submit()" />
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/cinema.png" alt="ticket">
                                </div>
                                <span class="type">per page</span>
                                <select class="select-bar" name="per_page" onchange="this.form.submit()">
                                    {% for n in per_page_options %}
                                    <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="tab-item">
                        <form class="ticket-search-form">
                            <div class="form-group large">
                                <input type="text" placeholder="Search fo Sports">
                                <button type="submit"><i class="fas fa-search"></i></button>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/city.png" alt="ticket">
                                </div>
                                <span class="type">city</span>
                                <select class="select-bar">
                                    <option value="london">London</option>
                                    <option value="dhaka">dhaka</option>
                                    <option value="rosario">rosario</option>
                                    <option value="madrid">madrid</option>
                                    <option value="koltaka">kolkata</option>
                                    <option value="rome">rome</option>
                                    <option value="khoksa">khoksa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/date.png" alt="ticket">
                                </div>
                                <span class="type">date</span>
                                <select class="select-bar">
                                    <option value="26-12-19">23/10/2020</option>
                                    <option value="26-12-19">24/10/2020</option>
                                    <option value="26-12-19">25/10/2020</option>
                                    <option value="26-12-19">26/10/2020</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="thumb">
                                    <img src="https://pixner.net/boleto/demo/assets/images/ticket/cinema.png" alt="ticket">
                                </div>
                                <span class="type">sports</span>
                                <select class="select-bar">
                                    <option value="football">football</option>
                                    <option value="cricket">cricket</option>
                                    <option value="cabadi">cabadi</option>
                                    <option value="madrid">madrid</option>
                                    <option value="gadon">gadon</option>
                                    <option value="rome">rome</option>
                                    <option value="khoksa">khoksa</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>    
    <!-- ==========Ticket-Search========== -->

    <!-- ==========Event-Section========== -->
    <section class="event-section padding-top padding-bottom">
        <div class="container">
            <div class="row flex-wrap-reverse justify-content-center">
                <div class="col-sm-10 col-md-8 col-lg-3">
                    <div class="widget-1 widget-check">
                        <div class="widget-header">
                            <h5 class="m-title">Filter By</h5> <a href="#0" class="clear-check">Clear All</a>
                        </div>
                        <div class="widget-1-body">
                            <h6 class="subtitle">categories</h6>
                            <form method="get" id="categoryForm">
                                <input type="hidden" name="q" value="{{ search_query }}">
                                <input type="hidden" name="city" value="{{ selected_city }}">
                                <input type="hidden" name="date" value="{{ selected_date }}">
                                <input type="hidden" name="per_page" value="{{ per_page }}">
                                <input type="hidden" name="sort" value="{{ selected_sort }}">
                                <div class="check-area">
                                    <div class="form-group">
                                        <input type="checkbox" id="cat-all" {% if not selected_categories %}checked{% endif %} onclick="handleAllCategoryClick(event)">
                                        <label for="cat-all">ALL</label>
                                    </div>
                                    {% for cat in category_list %}
                                    <div class="form-group">
                                        <input type="checkbox" name="category" value="{{ cat.id }}" id="cat-{{ cat.id }}" {% if cat.id|stringformat:'s' in selected_categories or cat.slug in selected_categories or cat.name in selected_categories %}checked{% endif %} onchange="document.getElementById('categoryForm').submit()">
                                        <label for="cat-{{ cat.id }}">{{ cat.name }}</label>
                                    </div>
                                    {% empty %}
                                    <p>No categories yet. Add some in admin.</p>
                                    {% endfor %}
                                </div>
                            </form>
                            <script>
                                function handleAllCategoryClick(e){
                                    const form = document.getElementById('categoryForm');
                                    if(e.target.checked){
                                        // Uncheck all category checkboxes and submit with no category params
                                        const checks = form.querySelectorAll("input[name='category']");
                                        checks.forEach(cb => cb.checked = false);
                                        form.submit();
                                    } else {
                                        // Prevent unchecking ALL without selecting anything else
                                        e.target.checked = true;
                                    }
                                }
                            </script>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 mb-50 mb-lg-0">
                    <div class="filter-tab">
                        <div class="filter-area">
                            <div class="filter-main">
                                <div class="left w-100 justify-content-between">
                                    <div class="item">
                                        <span class="show">Show :</span>
                                        <select class="select-bar">
                                            <option value="12">12</option>
                                            <option value="15">15</option>
                                            <option value="18">18</option>
                                            <option value="21">21</option>
                                            <option value="24">24</option>
                                            <option value="27">27</option>
                                            <option value="30">30</option>
                                        </select>
                                    </div>
                                    <div class="item mr-0">
                                        <span class="show">Sort By :</span>
                                        <form method="get" id="sortForm">
                                            <input type="hidden" name="q" value="{{ search_query }}">
                                            <input type="hidden" name="city" value="{{ selected_city }}">
                                            <input type="hidden" name="date" value="{{ selected_date }}">
                                            <input type="hidden" name="per_page" value="{{ per_page }}">
                                            <select class="select-bar" name="sort" onchange="document.getElementById('sortForm').submit()">
                                                <option value="date_desc" {% if selected_sort == 'date_desc' %}selected{% endif %}>Newest</option>
                                                <option value="date_asc" {% if selected_sort == 'date_asc' %}selected{% endif %}>Oldest</option>
                                                <option value="name_asc" {% if selected_sort == 'name_asc' %}selected{% endif %}>Name A-Z</option>
                                                <option value="name_desc" {% if selected_sort == 'name_desc' %}selected{% endif %}>Name Z-A</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-10 justify-content-center">
        {% for event in events %}
                            <div class="col-sm-6 col-lg-4">
                                <div class="event-grid">
                                    <div class="movie-thumb c-thumb">
                                        <a href="{% url 'event_detail' event.id %}">
                                            <img src="{{ event.image_url }}" alt="{{ event.name }}">
                                        </a>
                                        <div class="event-date">
                                            <h6 class="date-title">{{ event.date|date:"d" }}</h6>
                                            <span>{{ event.date|date:"M" }}</span>
                                        </div>
                                    </div>
                                    <div class="movie-content bg-one">
                                        <h5 class="title m-0">
                                            <a href="{% url 'event_detail' event.id %}">{{ event.name }}</a>
                                        </h5>
                                        <div class="movie-rating-percent">
                                            <span>{{ event.location }}</span>
                                        </div>
                                    </div>
                                </div>
            </div>
        {% empty %}
            <p class="no-events">No events available.</p>
        {% endfor %}
    </div>
                        <div class="pagination-area text-center">
                            {% if page_obj.has_previous %}
                              <a href="?q={{ search_query }}&city={{ selected_city }}&date={{ selected_date }}&per_page={{ per_page }}&sort={{ selected_sort }}&page={{ page_obj.previous_page_number }}">
                                <i class="fas fa-angle-double-left"></i><span>Prev</span>
                              </a>
                            {% endif %}
                            {% for num in paginator.page_range %}
                              {% if page_obj.number == num %}
                                <a href="#0" class="active">{{ num }}</a>
                              {% else %}
                                <a href="?q={{ search_query }}&city={{ selected_city }}&date={{ selected_date }}&per_page={{ per_page }}&sort={{ selected_sort }}&page={{ num }}">{{ num }}</a>
                              {% endif %}
                            {% endfor %}
                            {% if page_obj.has_next %}
                              <a href="?q={{ search_query }}&city={{ selected_city }}&date={{ selected_date }}&per_page={{ per_page }}&sort={{ selected_sort }}&page={{ page_obj.next_page_number }}">
                                <span>Next</span><i class="fas fa-angle-double-right"></i>
                              </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- ==========Event-Section========== -->
{% endblock %}
